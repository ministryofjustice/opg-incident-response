FROM node:lts-alpine3.23@sha256:c921b97d4b74f51744057454b306b418cf693865e73b8100559189605f6955b8 AS asset-env

WORKDIR /app

COPY nginx/webpack .

RUN yarn  --immutable --frozen-lockfile --ignore-scripts && yarn build

FROM nginx:stable-alpine

COPY nginx/default.conf.template /etc/nginx/templates/default.conf.template
COPY nginx/nginx.conf /etc/nginx/nginx.conf
COPY opgincidentresponse/static /app/opgincidentresponse/static
COPY --from=node /home/node /app/opgincidentresponse/static
COPY --from=asset-env /app/dist /app/opgincidentresponse/static

ENV TIMEOUT=20
